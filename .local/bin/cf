#!/bin/sh
#
# cf | cf.sh | interactive-config-editor.sh
#
# Author: github.com/ya-suke
# Description: This script allows you to interactively select and edit configuration files
#              from a Git repository using fzf.
# License: MIT License

# This script allows you to interactively select and edit
#      configuration files from a Git repository using fzf.

# From yadm, or your preferred dotfiles manager
# Get a list of configuration files from the Git repository, excluding files ending with ".py" and ".pyc"
dotgitls='/usr/bin/git --git-dir=/home/yasuke/dotfiles/ --work-tree=/home/yasuke ls-tree --full-tree -r HEAD'

configs=$($dotgitls | awk '{print $4}' | xargs -n1 basename | grep -Ev '\.py$|\.pyc$' | sort -u)

# Use fzf to interactively select a configuration file
selected=$(printf "%s\n" "$configs" | fzf)

if [ -n "$selected" ]; then
    # Use grep with word boundaries to ensure an exact match
    config_file=$($dotgitls | grep -E "\b$selected\b" | awk '{print $4}')
    
    if [ -n "$config_file" ]; then
        # Open the selected configuration file in the user's preferred text editor
        $EDITOR "$config_file"
    else
        echo "Error: Unable to find a unique match for '$selected'."
    fi
fi
